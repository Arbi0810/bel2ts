var wppizzaDbpIs=function(e){};jQuery(document).ready(function(x){var e=void 0!==wppizza.isCheckout,y="wppizza-dbp",l=x("#"+y+"-area-tb-spu"),j=x("."+y+"-thickbox"),z=x(".wppizza-order-pickup"),u=x(".wppizza-toggle-pickup");0<x("#"+y+"-thickbox").length&&jQuery.post(wppizza.ajaxurl,{action:"wppizza_dbp_json",vars:{type:"dbp-thickbox"}},function(e){0==e.nothickbox&&jQuery(function(){var e=x("#"+y+"-thickbox").find("legend").text();tb_show(e,"#TB_inline?height=300&amp;width=300&amp;inlineId="+y+"-thickbox",null);j.parent().css({margin:"0 auto"})})},"json").error(function(e,i,a){console.log("error 1 : "+a),console.log(e.responseText)});var C=0;x(document).on("change click _trigger_update","."+y+"-area, #"+y+"-area, #"+y+"-area-tb-set, #"+y+"-area-tb-map-spu",function(e){if(!("_trigger_update"==e.type&&0<C)){C++;var i=x(this),a=!1,p=x("#"+y+"-area"),t=x("#"+y+"-area-tb-set");0<z.length&&(a=!0,z.prop("checked")||(a=!1)),0<u.length&&(a=!0,u.prop("checked")||(a=!1));var r=!0;if(i.attr("id")==y+"-area-tb-map-spu"&&(a=!(r=!1)),0<l.length&&l.prop("checked")&&(a=!0),r){if(0<t.length&&i.attr("id")!=y+"-area-tb-set")return;if(t.length<=0&&"click"==e.type)return}var n=!1;if(0<l.length&&(n=!0,l.prop("checked")||(n=!1)),"click"==e.type&&0<t.length&&""==p.val()&&!n)return t.after('<div id="'+y+'-select-error" class="wppizza-login-error">'+wppizza.extend.wppizza_dbp.msg_select+"</div>"),t.attr("disabled","true"),void x("#"+y+"-select-error").delay(2e3).fadeOut(1e3,function(){t.removeAttr("disabled")});void 0!==wppizza.isCheckout?x(document).data("wppizza.is_self_pickup")||(x("html").css({position:"relative",height:"auto"}),x("body").prepend('<div id="wppizza-loading" class="wppizza-dbp-loading" style="opacity:1;"></div>')):j.prepend('<div id="wppizza-loading" class="wppizza-dbp-loading" style="opacity:0.9;"></div>');var o=i.closest("form"),d=!1;0<o.length&&(d=o.serialize());var s=x("#"+y+"-area").val(),c=void 0!==wppizza.isCheckout;jQuery.post(wppizza.ajaxurl,{action:"wppizza_dbp_json",vars:{type:"dbp",dbpid:s,data:d,selfPickup:a,isCheckout:c}},function(e){var i;void 0===e.redirect||""==e.redirect?(x(document).data("wppizza.is_self_pickup")&&(i=e.session.dbplbl,x("#"+y+"-area").val(i)),!a&&x(document).data("wppizza.is_self_pickup")||window.location.reload(!0)):window.location.href=e.redirect},"json").error(function(e,i,a){x("#wppizza-loading").remove(),console.log("error 2 : "+a),console.log(e.responseText)})}});var p,i=x("#TB_ajaxContent > ."+y+"-thickbox");"undefined"!=typeof tb_remove&&0<i.length&&(p=tb_remove,tb_remove=function(){var e=x("#"+y+"-area"),i=e.val();if(0<e.length){var a=wppizza.extend.wppizza_dbp.msg_select;return(""!=i||0<l.length&&l.prop("checked"))&&(a=wppizza.extend.wppizza_dbp.msg_confirm),x("#"+y+"-area-tb-set").after('<div id="'+y+'-select-error" class="wppizza-login-error">'+a+"</div>"),void x("#"+y+"-select-error").delay(3e3).fadeOut(1e3)}return p(),!1});function a(e){var a,n,o,d,s,w,i,f,m,b,_,h,k;0<x("#"+y+"-area-is").length&&(x(document).data("wppizza.is_self_pickup",null),(n=x("#"+(a=y+"-area-is"))).attr("autocomplete","off"),n.after('<ul class="'+y+'-ac"></ul><input id="'+y+'-area" name="'+y+'-area" type="hidden" value="" />'),o=x("#"+y+"-area"),x("#"+y+"-area-tb-set"),d=n.next("."+y+"-ac"),void 0!==wppizza.extend.wppizza_dbp.pm&&(s=x("#wppizza-dbp-form"),n.closest("form"),w=new RegExp(""+wppizza.extend.wppizza_dbp.pm.x,""+wppizza.extend.wppizza_dbp.pm.f),l.on("change",function(){var e=!!l.prop("checked");x(document).data("wppizza.is_self_pickup",e),e?(n.removeAttr("required"),x("#"+a+"-error").remove()):n.attr("required",!0)}),i='<div class="'+y+'-ac-msg-a">'+wppizza.extend.wppizza_dbp.pm.msg.a+"</div>",f='<div class="'+y+'-ac-msg-a">'+wppizza.extend.wppizza_dbp.pm.msg.a+"</div>",m='<div class="'+y+'-ac-msg-c">'+wppizza.extend.wppizza_dbp.pm.msg.c+"</div>",b='<div class="'+y+'-ac-msg-c">'+wppizza.extend.wppizza_dbp.pm.msg.c+"</div>",_='<div class="'+y+'-ac-msg-i">'+wppizza.extend.wppizza_dbp.pm.msg.i+"</div>",h=i,k=function(e){var i;e!=h&&(h=e,n.rules("add",{messages:{wppizza_dbp_is:h}}),i=x("#"+a+"-error"),e!=_&&e!=m||d.css({display:"none"}),""!==e?""==e||i.css({display:"block"}).html(e):i.css({display:"none"}).html(""))}),jQuery.post(wppizza.ajaxurl,{action:"wppizza_dbp_json",vars:{type:"dbpis"}},function(e){void 0!==e.current&&(void 0!==wppizza.extend.wppizza_dbp.pm?o.val(e.user_value):o.val(e.current)),x(document).data("wppizza.is_self_pickup",e.selfPickup);var p,i=e.areas,c=[],l={};void 0!==wppizza.extend.wppizza_dbp.pm&&(p={});var t,z,u,g,v,a,r=0;x.each(i,function(e,i){var a=void 0!==wppizza.extend.wppizza_dbp.pm?i.toUpperCase():i;c.push(a),l[a]=String(e),void 0!==wppizza.extend.wppizza_dbp.pm&&(p[r]=i.replace(/ /g,"").length,r++)}),void 0!==wppizza.extend.wppizza_dbp.pm&&(s.validate({onkeyup:function(e){n.valid()},submitHandler:function(e){return j.prepend('<div id="wppizza-loading" class="wppizza-dbp-loading" style="opacity:0.9;"></div>'),o.trigger("change"),!1}}),n.rules("add",{wppizza_dbp_is:!0,messages:{required:h,wppizza_dbp_is:h}}),z=t=!1,g=0,v=u=-1,""==n.val()&&g++,x.validator.methods.wppizza_dbp_is=function(e,i){if(x(document).data("wppizza.is_self_pickup")&&""==e)return!0;z=t=!1;var n=e.replace(/ /g,"").toUpperCase(),a=!1,o=!1,d=!1,s=n.length;return x.each(p,function(e,i){var a,p,t=n.substring(0,i),r=c[e].replace(/ /g,"");r.substring(0,s)==n&&(d=!0),t==r&&(z=d=!0,a=n.substring(i),w.test(a)&&(p=c[e],o=l[p],0==g&&(u=o,g++),v=o))}),o&&(t=a=!0),""==e&&k(f),""==e||z||d||k(_),""!=e&&!z&&d&&k(b),""!=e&&z&&!t&&k(m),""!=e&&t&&k(""),a}),void 0!==wppizza.extend.wppizza_dbp.pm&&(a=function(e){if(e)return u!=v},n.smartAutoComplete({source:c,forceSelect:!1,minCharLimit:0,delay:100,filter:function(e,i){x(this).data("smart-autocomplete");var a,p,t=(a=i,p=new RegExp(e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),x.grep(a,function(e){return p.test(e)}));return 1==t.length&&z?t=[]:t},resultFormatter:function(e){return"<li>"+e.replace(new RegExp(x(this.context).val(),"gi"),"<strong>$&</strong>")+"</li>"},resultsContainer:d}),n.bind({focus:function(e){n.trigger("keyup")},keyIn:function(e){C=0,x(this).valid()},lostFocus:function(e){if(""!=x(this).val()&&x(this).trigger("keyup"),a(t))return d.css({display:"none"}),x("#"+y+"-area").val()==x(this).val()||o.trigger("_trigger_update"),!1},itemSelect:function(e,i){if(x(this).keyup(function(e){if((13==e.keyCode||35==e.keyCode)&&a(t))return d.css({display:"none"}),x("#"+y+"-area").val()==x(this).val()||o.trigger("_trigger_update"),!1}),void 0===i)return o.trigger("_trigger_update"),!1}}))},"json").error(function(e,i,a){console.log("error 3 : "+a),console.log(e.responseText)}))}e&&void 0===wppizza.usingCache&&a(),wppizzaDbpIs=function(e){a()},e||a()});